import urllib, urllib2, os, webbrowser
from HTMLParser import HTMLParser

token = ""

class My_HTML_Parser(HTMLParser):
  def handle_startendtag(self, tag, attrs):
    if tag == 'input':
      attribute_dict = dict(attrs)
      if attribute_dict['name'] == 'csrf_token':
        global token
        token = attribute_dict['value']

url = 'http://www.wsb.com/Assignment2/case09.php'
request = urllib2.Request(url)
response = urllib2.urlopen(request)
content = response.read()

parser = My_HTML_Parser()
parser.feed(content)

values = dict(data = 'CSRF test', csrf_token = token)
data = urllib.urlencode(values)
req = urllib2.Request(url, data)
rsp = urllib2.urlopen(req)
content = rsp.read()

tmp_file = os.getcwd() + "/Code/Result_Html/case09.html"
print tmp_file
fp = open(tmp_file, "w")
fp.write(content)
fp.close()
webbrowser.open("file://" + os.path.realpath(tmp_file),new = 2)